import{s as Re,n as Ne,r as ze,c as ye,o as Le}from"../chunks/CBAgXpWv.js";import{S as He,i as Qe,d as u,s as A,a as we,b as t,p as Ve,q as h,r as je,g as x,c as f,e as v,u as Ge,f as _,j as q,h as d,t as k}from"../chunks/B5JCov3p.js";import{p as Ye}from"../chunks/nXDHGAW3.js";import{s as Ke}from"../chunks/C1I1J8-N.js";import{g as Fe}from"../chunks/DPVYIKXt.js";import{$ as Je}from"../chunks/BdT7tXd5.js";const Xe=!1,ft=Object.freeze(Object.defineProperty({__proto__:null,prerender:Xe},Symbol.toStringTag,{value:"Module"}));class Ee{constructor(){this._buffer=[]}static _concatBuffers(e){const o=e.reduce((l,i)=>l+i.length,0),s=new Uint8Array(o);let r=0;for(const l of e)s.set(l,r),r+=l.length;return s}_enqueue(e){this._buffer.push(e)}encode(){const e=Ee._concatBuffers(this._buffer);return this._buffer=[],e}text(e=""){return this._enqueue(new TextEncoder().encode(e)),this}newline(e=1){return this._enqueue(new Uint8Array(new Array(e).fill(10))),this}alignLeft(){return this._enqueue(new Uint8Array([27,97,0])),this}alignCenter(){return this._enqueue(new Uint8Array([27,97,1])),this}alignRight(){return this._enqueue(new Uint8Array([27,97,2])),this}boldOn(){return this._enqueue(new Uint8Array([27,69,1])),this}boldOff(){return this._enqueue(new Uint8Array([27,69,0])),this}size(e=0){return this._enqueue(new Uint8Array([29,33,e])),this}cut(){return this._enqueue(new Uint8Array([29,86,0])),this}feed(e=1){return this._enqueue(new Uint8Array([27,100,e])),this}underline(e=0){return this._enqueue(new Uint8Array([27,45,e])),this}invert(e=!0){return this._enqueue(new Uint8Array([29,66,e?1:0])),this}emphasize(e=!0){return this._enqueue(new Uint8Array([27,69,e?1:0])),this}doubleStrike(e=!0){return this._enqueue(new Uint8Array([27,71,e?1:0])),this}setCharacterSet(e="PC437"){const s={PC437:0,KATAKANA:1,PC850:2,PC860:3,PC863:4,PC865:5,WPC1252:16,PC866:18,PC852:19,PC858:20}[e.toUpperCase()]||0;return this._enqueue(new Uint8Array([27,116,s])),this}printBarcode(e,o,s=50,r=2,l=0,i="left"){this._enqueue(new Uint8Array([29,72,l])),this._enqueue(new Uint8Array([29,119,r])),this._enqueue(new Uint8Array([29,104,s]));let m=0;i==="center"?m=1:i==="right"&&(m=2),this._enqueue(new Uint8Array([27,97,m]));let c;switch(o.toUpperCase()){case"UPC-A":c=0;break;case"UPC-E":c=1;break;case"EAN13":c=2;break;case"EAN8":c=3;break;case"CODE39":c=4;break;case"ITF":c=5;break;case"CODABAR":c=6;break;case"CODE93":c=73;break;case"CODE128":c=74;break;default:throw new Error("Unsupported barcode type")}const b=new TextEncoder().encode(e);return this._enqueue(new Uint8Array([29,107,c,b.length,...b])),this}printQRCode(e,o=3,s="M"){let r=49;switch(s.toUpperCase()){case"L":r=48;break;case"M":r=49;break;case"Q":r=50;break;case"H":r=51;break}const l=new TextEncoder().encode(e),i=l.length+3;return this._enqueue(new Uint8Array([29,40,107,4,0,49,65,50,0])),this._enqueue(new Uint8Array([29,40,107,3,0,49,67,o])),this._enqueue(new Uint8Array([29,40,107,3,0,49,69,r])),this._enqueue(new Uint8Array([29,40,107,i%256,Math.floor(i/256),49,80,48,...l])),this._enqueue(new Uint8Array([29,40,107,3,0,49,81,48])),this}}function Ze(a){let e="";const o=a.length;for(let s=0;s<o;s++)e+=String.fromCharCode(a[s]);return btoa(e)}function Oe(a){let e,o,s,r=a[4]("tokenPage.section")+"",l,i,m,c=a[1].name+"",b,C,P,g,w=a[4]("tokenPage.type")+"",T,n,B,U=(a[1].type==="clinic"?a[4]("tokenPage.clinic"):a[4]("tokenPage.laboratory"))+"",R,K,V,G,M=a[4]("tokenPage.feePaid")+"",F,ae,O,W=a[1].price+"",z,Z,J=a[4]("currency")+"",L;return{c(){e=d("div"),o=d("div"),s=d("span"),l=k(r),i=q(),m=d("span"),b=k(c),C=q(),P=d("div"),g=d("span"),T=k(w),n=q(),B=d("span"),R=k(U),K=q(),V=d("div"),G=d("span"),F=k(M),ae=q(),O=d("span"),z=k(W),Z=q(),L=k(J),this.h()},l(y){e=f(y,"DIV",{class:!0});var E=v(e);o=f(E,"DIV",{class:!0});var X=v(o);s=f(X,"SPAN",{class:!0});var H=v(s);l=_(H,r),H.forEach(u),i=x(X),m=f(X,"SPAN",{class:!0});var Q=v(m);b=_(Q,c),Q.forEach(u),X.forEach(u),C=x(E),P=f(E,"DIV",{class:!0});var $=v(P);g=f($,"SPAN",{class:!0});var ee=v(g);T=_(ee,w),ee.forEach(u),n=x($),B=f($,"SPAN",{class:!0});var re=v(B);R=_(re,U),re.forEach(u),$.forEach(u),K=x(E),V=f(E,"DIV",{class:!0});var te=v(V);G=f(te,"SPAN",{class:!0});var j=v(G);F=_(j,M),j.forEach(u),ae=x(te),O=f(te,"SPAN",{class:!0});var ne=v(O);z=_(ne,W),Z=x(ne),L=_(ne,J),ne.forEach(u),te.forEach(u),E.forEach(u),this.h()},h(){h(s,"class","info-label svelte-1w8mmqf"),h(m,"class","info-value svelte-1w8mmqf"),h(o,"class","info-row svelte-1w8mmqf"),h(g,"class","info-label svelte-1w8mmqf"),h(B,"class","info-value svelte-1w8mmqf"),h(P,"class","info-row svelte-1w8mmqf"),h(G,"class","info-label svelte-1w8mmqf"),h(O,"class","info-value svelte-1w8mmqf"),h(V,"class","info-row svelte-1w8mmqf"),h(e,"class","section-info svelte-1w8mmqf")},m(y,E){we(y,e,E),t(e,o),t(o,s),t(s,l),t(o,i),t(o,m),t(m,b),t(e,C),t(e,P),t(P,g),t(g,T),t(P,n),t(P,B),t(B,R),t(e,K),t(e,V),t(V,G),t(G,F),t(V,ae),t(V,O),t(O,z),t(O,Z),t(O,L)},p(y,E){E&16&&r!==(r=y[4]("tokenPage.section")+"")&&A(l,r),E&2&&c!==(c=y[1].name+"")&&A(b,c),E&16&&w!==(w=y[4]("tokenPage.type")+"")&&A(T,w),E&18&&U!==(U=(y[1].type==="clinic"?y[4]("tokenPage.clinic"):y[4]("tokenPage.laboratory"))+"")&&A(R,U),E&16&&M!==(M=y[4]("tokenPage.feePaid")+"")&&A(F,M),E&2&&W!==(W=y[1].price+"")&&A(z,W),E&16&&J!==(J=y[4]("currency")+"")&&A(L,J)},d(y){y&&u(e)}}}function Me(a){let e,o,s=a[4]("queue.positionInQueue")+"",r,l,i,m=a[1].queue.findIndex(a[10])+1+"",c,b,C=a[1].queue.length+"",P;return{c(){e=d("div"),o=d("p"),r=k(s),l=q(),i=d("p"),c=k(m),b=k(" / "),P=k(C),this.h()},l(g){e=f(g,"DIV",{class:!0});var w=v(e);o=f(w,"P",{class:!0});var T=v(o);r=_(T,s),T.forEach(u),l=x(w),i=f(w,"P",{class:!0});var n=v(i);c=_(n,m),b=_(n," / "),P=_(n,C),n.forEach(u),w.forEach(u),this.h()},h(){h(o,"class","queue-label svelte-1w8mmqf"),h(i,"class","queue-number svelte-1w8mmqf"),h(e,"class","queue-position svelte-1w8mmqf")},m(g,w){we(g,e,w),t(e,o),t(o,r),t(e,l),t(e,i),t(i,c),t(i,b),t(i,P)},p(g,w){w&16&&s!==(s=g[4]("queue.positionInQueue")+"")&&A(r,s),w&3&&m!==(m=g[1].queue.findIndex(g[10])+1+"")&&A(c,m),w&2&&C!==(C=g[1].queue.length+"")&&A(P,C)},d(g){g&&u(e)}}}function $e(a){let e,o,s,r,l,i,m="ðŸ¥",c,b,C=a[4]("hospital.title")+"",P,g,w,T=a[4]("tokenPage.subtitle")+"",n,B,U,R,K=a[4]("tokenPage.yourTokenNumber")+"",V,G,M,F,ae,O,W,z,Z,J,L,y,E,X,H,Q,$,ee=a[4]("tokenPage.printToken")+"",re,te,j,ne,le=a[4]("tokenPage.backToHome")+"",fe,be,se,Y,ce=a[4]("tokenPage.thankYouMessage")+"",de,ge,_e,ke,ue=a[4]("hospital.title")+"",he,Pe,Ae;document.title=e=a[4]("tokenPage.yourTokenNumber")+" #"+a[0]+" - "+a[4]("hospital.title");let I=a[1]&&Oe(a),D=a[1]&&Me(a);return{c(){o=q(),s=d("div"),r=d("div"),l=d("div"),i=d("div"),i.textContent=m,c=q(),b=d("h1"),P=k(C),g=q(),w=d("p"),n=k(T),B=q(),U=d("div"),R=d("p"),V=k(K),G=q(),M=d("div"),F=k(a[0]),ae=q(),I&&I.c(),O=q(),W=d("div"),z=d("p"),Z=k(a[2]),J=q(),L=d("p"),y=k(a[3]),E=q(),D&&D.c(),X=q(),H=d("div"),Q=d("button"),$=k("ðŸ–¨ï¸ "),re=k(ee),te=q(),j=d("button"),ne=k("ðŸ  "),fe=k(le),be=q(),se=d("div"),Y=d("p"),de=k(ce),ge=q(),_e=d("br"),ke=q(),he=k(ue),this.h()},l(p){je("svelte-1swwec3",document.head).forEach(u),o=x(p),s=f(p,"DIV",{class:!0});var Ce=v(s);r=f(Ce,"DIV",{class:!0});var N=v(r);l=f(N,"DIV",{class:!0});var oe=v(l);i=f(oe,"DIV",{class:!0,"data-svelte-h":!0}),Ge(i)!=="svelte-17r3utu"&&(i.textContent=m),c=x(oe),b=f(oe,"H1",{class:!0});var Ue=v(b);P=_(Ue,C),Ue.forEach(u),g=x(oe),w=f(oe,"P",{class:!0});var Se=v(w);n=_(Se,T),Se.forEach(u),oe.forEach(u),B=x(N),U=f(N,"DIV",{class:!0});var ve=v(U);R=f(ve,"P",{class:!0});var Ie=v(R);V=_(Ie,K),Ie.forEach(u),G=x(ve),M=f(ve,"DIV",{class:!0});var De=v(M);F=_(De,a[0]),De.forEach(u),ve.forEach(u),ae=x(N),I&&I.l(N),O=x(N),W=f(N,"DIV",{class:!0});var pe=v(W);z=f(pe,"P",{class:!0});var Te=v(z);Z=_(Te,a[2]),Te.forEach(u),J=x(pe),L=f(pe,"P",{class:!0});var Be=v(L);y=_(Be,a[3]),Be.forEach(u),pe.forEach(u),E=x(N),D&&D.l(N),X=x(N),H=f(N,"DIV",{class:!0});var me=v(H);Q=f(me,"BUTTON",{class:!0});var xe=v(Q);$=_(xe,"ðŸ–¨ï¸ "),re=_(xe,ee),xe.forEach(u),te=x(me),j=f(me,"BUTTON",{class:!0});var qe=v(j);ne=_(qe,"ðŸ  "),fe=_(qe,le),qe.forEach(u),me.forEach(u),be=x(N),se=f(N,"DIV",{class:!0});var We=v(se);Y=f(We,"P",{class:!0});var ie=v(Y);de=_(ie,ce),ge=x(ie),_e=f(ie,"BR",{}),ke=x(ie),he=_(ie,ue),ie.forEach(u),We.forEach(u),N.forEach(u),Ce.forEach(u),this.h()},h(){h(i,"class","hospital-logo svelte-1w8mmqf"),h(b,"class","svelte-1w8mmqf"),h(w,"class","subtitle svelte-1w8mmqf"),h(l,"class","print-header svelte-1w8mmqf"),h(R,"class","label svelte-1w8mmqf"),h(M,"class","token-number svelte-1w8mmqf"),h(U,"class","token-number-section svelte-1w8mmqf"),h(z,"class","date svelte-1w8mmqf"),h(L,"class","time svelte-1w8mmqf"),h(W,"class","datetime-section svelte-1w8mmqf"),h(Q,"class","print-btn svelte-1w8mmqf"),h(j,"class","home-btn svelte-1w8mmqf"),h(H,"class","actions svelte-1w8mmqf"),h(Y,"class","footer-main svelte-1w8mmqf"),h(se,"class","token-footer svelte-1w8mmqf"),h(r,"class","token-card svelte-1w8mmqf"),h(s,"class","container svelte-1w8mmqf")},m(p,S){we(p,o,S),we(p,s,S),t(s,r),t(r,l),t(l,i),t(l,c),t(l,b),t(b,P),t(l,g),t(l,w),t(w,n),t(r,B),t(r,U),t(U,R),t(R,V),t(U,G),t(U,M),t(M,F),t(r,ae),I&&I.m(r,null),t(r,O),t(r,W),t(W,z),t(z,Z),t(W,J),t(W,L),t(L,y),t(r,E),D&&D.m(r,null),t(r,X),t(r,H),t(H,Q),t(Q,$),t(Q,re),t(H,te),t(H,j),t(j,ne),t(j,fe),t(r,be),t(r,se),t(se,Y),t(Y,de),t(Y,ge),t(Y,_e),t(Y,ke),t(Y,he),Pe||(Ae=[Ve(Q,"click",a[5]),Ve(j,"click",a[6])],Pe=!0)},p(p,[S]){S&17&&e!==(e=p[4]("tokenPage.yourTokenNumber")+" #"+p[0]+" - "+p[4]("hospital.title"))&&(document.title=e),S&16&&C!==(C=p[4]("hospital.title")+"")&&A(P,C),S&16&&T!==(T=p[4]("tokenPage.subtitle")+"")&&A(n,T),S&16&&K!==(K=p[4]("tokenPage.yourTokenNumber")+"")&&A(V,K),S&1&&A(F,p[0]),p[1]?I?I.p(p,S):(I=Oe(p),I.c(),I.m(r,O)):I&&(I.d(1),I=null),S&4&&A(Z,p[2]),S&8&&A(y,p[3]),p[1]?D?D.p(p,S):(D=Me(p),D.c(),D.m(r,X)):D&&(D.d(1),D=null),S&16&&ee!==(ee=p[4]("tokenPage.printToken")+"")&&A(re,ee),S&16&&le!==(le=p[4]("tokenPage.backToHome")+"")&&A(fe,le),S&16&&ce!==(ce=p[4]("tokenPage.thankYouMessage")+"")&&A(de,ce),S&16&&ue!==(ue=p[4]("hospital.title")+"")&&A(he,ue)},i:Ne,o:Ne,d(p){p&&(u(o),u(s)),I&&I.d(),D&&D.d(),Pe=!1,ze(Ae)}}}async function et(a){try{await tt(a);return}catch(e){console.warn("Web Bluetooth failed:",e)}try{await nt(a);return}catch(e){console.warn("Web USB failed:",e)}try{await at(a);return}catch(e){throw console.warn("Web Serial failed:",e),new Error("Could not connect to any printer via Web Bluetooth, Web USB, or Web Serial. Please ensure your printer is on, discoverable, and supported by one of these APIs.")}}async function tt(a){const e="000018f0-0000-1000-8000-00805f9b34fb",o="00002af1-0000-1000-8000-00805f9b34fb";if(!navigator.bluetooth)throw new Error("Web Bluetooth API is not available in this browser.");let s;try{s=await navigator.bluetooth.requestDevice({filters:[{services:[e]}],optionalServices:[e]}),console.log("Connecting to GATT Server (Bluetooth)...");const r=await s.gatt.connect();console.log("Getting Service...");const l=await r.getPrimaryService(e);console.log("Getting Characteristic...");const i=await l.getCharacteristic(o);console.log("Sending data in chunks...");const m=20;for(let c=0;c<a.length;c+=m){const b=a.slice(c,c+m);await i.writeValueWithoutResponse(b)}console.log("Data sent to printer via Web Bluetooth.")}catch(r){throw s&&s.gatt.connected&&(console.log("Disconnecting from Bluetooth device."),s.gatt.disconnect()),r}finally{s&&s.gatt.connected&&s.gatt.disconnect()}}async function nt(a){if(!navigator.usb)throw new Error("Web USB API is not available in this browser.");let e;try{e=await navigator.usb.requestDevice({filters:[]}),await e.open(),e.configuration===null&&await e.selectConfiguration(1),await e.claimInterface(0);const o=e.configuration.interfaces[0].alternate.endpoints.find(r=>r.direction==="out");if(!o)throw new Error("No OUT endpoint found on the USB device.");console.log("Sending data via Web USB...");const s=64;for(let r=0;r<a.length;r+=s){const l=a.slice(r,r+s);await e.transferOut(o.endpointNumber,l)}console.log("Data sent to printer via Web USB.")}catch(o){throw e&&e.opened&&await e.close(),o}finally{e&&e.opened&&await e.close()}}async function at(a){if(!navigator.serial)throw new Error("Web Serial API is not available in this browser.");let e;try{e=await navigator.serial.requestPort(),await e.open({baudRate:9600});const o=e.writable.getWriter();console.log("Sending data via Web Serial..."),await o.write(a),o.releaseLock(),console.log("Data sent to printer via Web Serial.")}catch(o){throw e&&e.opened&&await e.close(),o}finally{e&&e.opened&&await e.close()}}function rt(a,e,o){let s,r,l,i,m,c;ye(a,Je,n=>o(4,i=n)),ye(a,Ke,n=>o(8,m=n)),ye(a,Ye,n=>o(9,c=n));let b="",C="";Le(()=>{P();const n=setInterval(P,1e3);return()=>clearInterval(n)});function P(){const n=new Date;o(2,b=n.toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"})),o(3,C=n.toLocaleTimeString(void 0))}async function g(){if(typeof window>"u")return;const n=new Ee;n.alignCenter(),n.size(17),n.text(i("hospital.title")),n.newline(),n.size(0),n.text(i("tokenPage.subtitle")),n.newline(2),n.text(i("tokenPage.yourTokenNumber")),n.newline(),n.size(34),n.text(s.toString()),n.newline(2),n.size(0),l&&(n.alignLeft(),n.text(`${i("tokenPage.section")}: ${l.name}`),n.newline(),n.text(`${i("tokenPage.type")}: ${l.type==="clinic"?i("tokenPage.clinic"):i("tokenPage.laboratory")}`),n.newline(),n.text(`${i("tokenPage.feePaid")}: ${l.price} ${i("currency")}`),n.newline(2)),n.alignCenter(),n.text(b),n.newline(),n.text(C),n.newline(2),n.printQRCode(s.toString(),6,"M"),n.newline(2),n.text(i("tokenPage.thankYouMessage")),n.newline(),n.text(i("hospital.title")),n.newline(4),n.cut();const B=n.encode();console.log("ESC/POS Data (Uint8Array):",B),console.log("ESC/POS Data (Base64):",Ze(B));try{await et(B),alert("Printing command sent successfully!")}catch(U){console.error("Printing failed:",U),alert("Printing failed: "+U.message+". Make sure your printer is connected and supported.")}}function w(){Fe("/")}const T=n=>n.number===s;return a.$$.update=()=>{a.$$.dirty&512&&o(0,s=parseInt(c.params.number)),a.$$.dirty&512&&o(7,r=parseInt(c.url.searchParams.get("section")||"0")),a.$$.dirty&384&&o(1,l=m.find(n=>n.id===r)),a.$$.dirty&3&&(l==null||l.queue.find(n=>n.number===s))},[s,l,b,C,i,g,w,r,m,c,T]}class dt extends He{constructor(e){super(),Qe(this,e,rt,$e,Re,{})}}export{dt as component,ft as universal};
