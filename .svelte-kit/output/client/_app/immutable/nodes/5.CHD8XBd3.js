import{s as Re,n as Be,r as He,c as Ee,o as Le}from"../chunks/CBAgXpWv.js";import{S as Qe,i as je,d as c,s as A,a as _e,b as e,p as Oe,q as h,r as Ge,g as q,c as f,e as v,u as We,f as g,j as P,h as d,t as k}from"../chunks/B5JCov3p.js";import{p as Ye}from"../chunks/BZX_rf1A.js";import{s as Fe}from"../chunks/C1I1J8-N.js";import{g as Ke}from"../chunks/CriB66hj.js";import{$ as Je}from"../chunks/BdT7tXd5.js";const Xe=!1,it=Object.freeze(Object.defineProperty({__proto__:null,prerender:Xe},Symbol.toStringTag,{value:"Module"}));class ye{constructor(){this._buffer=[]}static _concatBuffers(t){const i=t.reduce((l,o)=>l+o.length,0),r=new Uint8Array(i);let a=0;for(const l of t)r.set(l,a),a+=l.length;return r}_enqueue(t){this._buffer.push(t)}encode(){const t=ye._concatBuffers(this._buffer);return this._buffer=[],t}text(t=""){return this._enqueue(new TextEncoder().encode(t)),this}newline(t=1){return this._enqueue(new Uint8Array(new Array(t).fill(10))),this}alignLeft(){return this._enqueue(new Uint8Array([27,97,0])),this}alignCenter(){return this._enqueue(new Uint8Array([27,97,1])),this}alignRight(){return this._enqueue(new Uint8Array([27,97,2])),this}boldOn(){return this._enqueue(new Uint8Array([27,69,1])),this}boldOff(){return this._enqueue(new Uint8Array([27,69,0])),this}size(t=0){return this._enqueue(new Uint8Array([29,33,t])),this}cut(){return this._enqueue(new Uint8Array([29,86,0])),this}feed(t=1){return this._enqueue(new Uint8Array([27,100,t])),this}underline(t=0){return this._enqueue(new Uint8Array([27,45,t])),this}invert(t=!0){return this._enqueue(new Uint8Array([29,66,t?1:0])),this}emphasize(t=!0){return this._enqueue(new Uint8Array([27,69,t?1:0])),this}doubleStrike(t=!0){return this._enqueue(new Uint8Array([27,71,t?1:0])),this}setCharacterSet(t="PC437"){const r={PC437:0,KATAKANA:1,PC850:2,PC860:3,PC863:4,PC865:5,WPC1252:16,PC866:18,PC852:19,PC858:20}[t.toUpperCase()]||0;return this._enqueue(new Uint8Array([27,116,r])),this}printBarcode(t,i,r=50,a=2,l=0,o="left"){this._enqueue(new Uint8Array([29,72,l])),this._enqueue(new Uint8Array([29,119,a])),this._enqueue(new Uint8Array([29,104,r]));let p=0;o==="center"?p=1:o==="right"&&(p=2),this._enqueue(new Uint8Array([27,97,p]));let u;switch(i.toUpperCase()){case"UPC-A":u=0;break;case"UPC-E":u=1;break;case"EAN13":u=2;break;case"EAN8":u=3;break;case"CODE39":u=4;break;case"ITF":u=5;break;case"CODABAR":u=6;break;case"CODE93":u=73;break;case"CODE128":u=74;break;default:throw new Error("Unsupported barcode type")}const w=new TextEncoder().encode(t);return this._enqueue(new Uint8Array([29,107,u,w.length,...w])),this}printQRCode(t,i=3,r="M"){let a=49;switch(r.toUpperCase()){case"L":a=48;break;case"M":a=49;break;case"Q":a=50;break;case"H":a=51;break}const l=new TextEncoder().encode(t),o=l.length+3;return this._enqueue(new Uint8Array([29,40,107,4,0,49,65,50,0])),this._enqueue(new Uint8Array([29,40,107,3,0,49,67,i])),this._enqueue(new Uint8Array([29,40,107,3,0,49,69,a])),this._enqueue(new Uint8Array([29,40,107,o%256,Math.floor(o/256),49,80,48,...l])),this._enqueue(new Uint8Array([29,40,107,3,0,49,81,48])),this}}function Ze(s){let t="";const i=s.length;for(let r=0;r<i;r++)t+=String.fromCharCode(s[r]);return btoa(t)}function Me(s){let t,i,r,a=s[4]("tokenPage.section")+"",l,o,p,u=s[1].name+"",w,C,x,b,_=s[4]("tokenPage.type")+"",T,n,N,U=(s[1].type==="clinic"?s[4]("tokenPage.clinic"):s[4]("tokenPage.laboratory"))+"",R,F,O,W,z=s[4]("tokenPage.feePaid")+"",K,se,M,V=s[1].price+"",H,Z,J=s[4]("currency")+"",L;return{c(){t=d("div"),i=d("div"),r=d("span"),l=k(a),o=P(),p=d("span"),w=k(u),C=P(),x=d("div"),b=d("span"),T=k(_),n=P(),N=d("span"),R=k(U),F=P(),O=d("div"),W=d("span"),K=k(z),se=P(),M=d("span"),H=k(V),Z=P(),L=k(J),this.h()},l(E){t=f(E,"DIV",{class:!0});var y=v(t);i=f(y,"DIV",{class:!0});var X=v(i);r=f(X,"SPAN",{class:!0});var Q=v(r);l=g(Q,a),Q.forEach(c),o=q(X),p=f(X,"SPAN",{class:!0});var j=v(p);w=g(j,u),j.forEach(c),X.forEach(c),C=q(y),x=f(y,"DIV",{class:!0});var $=v(x);b=f($,"SPAN",{class:!0});var ee=v(b);T=g(ee,_),ee.forEach(c),n=q($),N=f($,"SPAN",{class:!0});var ae=v(N);R=g(ae,U),ae.forEach(c),$.forEach(c),F=q(y),O=f(y,"DIV",{class:!0});var te=v(O);W=f(te,"SPAN",{class:!0});var G=v(W);K=g(G,z),G.forEach(c),se=q(te),M=f(te,"SPAN",{class:!0});var ne=v(M);H=g(ne,V),Z=q(ne),L=g(ne,J),ne.forEach(c),te.forEach(c),y.forEach(c),this.h()},h(){h(r,"class","info-label svelte-1w8mmqf"),h(p,"class","info-value svelte-1w8mmqf"),h(i,"class","info-row svelte-1w8mmqf"),h(b,"class","info-label svelte-1w8mmqf"),h(N,"class","info-value svelte-1w8mmqf"),h(x,"class","info-row svelte-1w8mmqf"),h(W,"class","info-label svelte-1w8mmqf"),h(M,"class","info-value svelte-1w8mmqf"),h(O,"class","info-row svelte-1w8mmqf"),h(t,"class","section-info svelte-1w8mmqf")},m(E,y){_e(E,t,y),e(t,i),e(i,r),e(r,l),e(i,o),e(i,p),e(p,w),e(t,C),e(t,x),e(x,b),e(b,T),e(x,n),e(x,N),e(N,R),e(t,F),e(t,O),e(O,W),e(W,K),e(O,se),e(O,M),e(M,H),e(M,Z),e(M,L)},p(E,y){y&16&&a!==(a=E[4]("tokenPage.section")+"")&&A(l,a),y&2&&u!==(u=E[1].name+"")&&A(w,u),y&16&&_!==(_=E[4]("tokenPage.type")+"")&&A(T,_),y&18&&U!==(U=(E[1].type==="clinic"?E[4]("tokenPage.clinic"):E[4]("tokenPage.laboratory"))+"")&&A(R,U),y&16&&z!==(z=E[4]("tokenPage.feePaid")+"")&&A(K,z),y&2&&V!==(V=E[1].price+"")&&A(H,V),y&16&&J!==(J=E[4]("currency")+"")&&A(L,J)},d(E){E&&c(t)}}}function ze(s){let t,i,r=s[4]("queue.positionInQueue")+"",a,l,o,p=s[1].queue.findIndex(s[10])+1+"",u,w,C=s[1].queue.length+"",x;return{c(){t=d("div"),i=d("p"),a=k(r),l=P(),o=d("p"),u=k(p),w=k(" / "),x=k(C),this.h()},l(b){t=f(b,"DIV",{class:!0});var _=v(t);i=f(_,"P",{class:!0});var T=v(i);a=g(T,r),T.forEach(c),l=q(_),o=f(_,"P",{class:!0});var n=v(o);u=g(n,p),w=g(n," / "),x=g(n,C),n.forEach(c),_.forEach(c),this.h()},h(){h(i,"class","queue-label svelte-1w8mmqf"),h(o,"class","queue-number svelte-1w8mmqf"),h(t,"class","queue-position svelte-1w8mmqf")},m(b,_){_e(b,t,_),e(t,i),e(i,a),e(t,l),e(t,o),e(o,u),e(o,w),e(o,x)},p(b,_){_&16&&r!==(r=b[4]("queue.positionInQueue")+"")&&A(a,r),_&3&&p!==(p=b[1].queue.findIndex(b[10])+1+"")&&A(u,p),_&2&&C!==(C=b[1].queue.length+"")&&A(x,C)},d(b){b&&c(t)}}}function $e(s){let t,i,r,a,l,o,p="ðŸ¥",u,w,C=s[4]("hospital.title")+"",x,b,_,T=s[4]("tokenPage.subtitle")+"",n,N,U,R,F=s[4]("tokenPage.yourTokenNumber")+"",O,W,z,K,se,M,V,H,Z,J,L,E,y,X,Q,j,$,ee=s[4]("tokenPage.printToken")+"",ae,te,G,ne,ie=s[4]("tokenPage.backToHome")+"",fe,we,re,Y,ue=s[4]("tokenPage.thankYouMessage")+"",de,be,ge,ke,ce=s[4]("hospital.title")+"",he,xe,Ae;document.title=t=s[4]("tokenPage.yourTokenNumber")+" #"+s[0]+" - "+s[4]("hospital.title");let S=s[1]&&Me(s),D=s[1]&&ze(s);return{c(){i=P(),r=d("div"),a=d("div"),l=d("div"),o=d("div"),o.textContent=p,u=P(),w=d("h1"),x=k(C),b=P(),_=d("p"),n=k(T),N=P(),U=d("div"),R=d("p"),O=k(F),W=P(),z=d("div"),K=k(s[0]),se=P(),S&&S.c(),M=P(),V=d("div"),H=d("p"),Z=k(s[2]),J=P(),L=d("p"),E=k(s[3]),y=P(),D&&D.c(),X=P(),Q=d("div"),j=d("button"),$=k("ðŸ–¨ï¸ "),ae=k(ee),te=P(),G=d("button"),ne=k("ðŸ  "),fe=k(ie),we=P(),re=d("div"),Y=d("p"),de=k(ue),be=P(),ge=d("br"),ke=P(),he=k(ce),this.h()},l(m){Ge("svelte-1swwec3",document.head).forEach(c),i=q(m),r=f(m,"DIV",{class:!0});var Ce=v(r);a=f(Ce,"DIV",{class:!0});var B=v(a);l=f(B,"DIV",{class:!0});var oe=v(l);o=f(oe,"DIV",{class:!0,"data-svelte-h":!0}),We(o)!=="svelte-17r3utu"&&(o.textContent=p),u=q(oe),w=f(oe,"H1",{class:!0});var Ue=v(w);x=g(Ue,C),Ue.forEach(c),b=q(oe),_=f(oe,"P",{class:!0});var Ie=v(_);n=g(Ie,T),Ie.forEach(c),oe.forEach(c),N=q(B),U=f(B,"DIV",{class:!0});var ve=v(U);R=f(ve,"P",{class:!0});var Se=v(R);O=g(Se,F),Se.forEach(c),W=q(ve),z=f(ve,"DIV",{class:!0});var De=v(z);K=g(De,s[0]),De.forEach(c),ve.forEach(c),se=q(B),S&&S.l(B),M=q(B),V=f(B,"DIV",{class:!0});var me=v(V);H=f(me,"P",{class:!0});var Te=v(H);Z=g(Te,s[2]),Te.forEach(c),J=q(me),L=f(me,"P",{class:!0});var Ne=v(L);E=g(Ne,s[3]),Ne.forEach(c),me.forEach(c),y=q(B),D&&D.l(B),X=q(B),Q=f(B,"DIV",{class:!0});var pe=v(Q);j=f(pe,"BUTTON",{class:!0});var qe=v(j);$=g(qe,"ðŸ–¨ï¸ "),ae=g(qe,ee),qe.forEach(c),te=q(pe),G=f(pe,"BUTTON",{class:!0});var Pe=v(G);ne=g(Pe,"ðŸ  "),fe=g(Pe,ie),Pe.forEach(c),pe.forEach(c),we=q(B),re=f(B,"DIV",{class:!0});var Ve=v(re);Y=f(Ve,"P",{class:!0});var le=v(Y);de=g(le,ue),be=q(le),ge=f(le,"BR",{}),ke=q(le),he=g(le,ce),le.forEach(c),Ve.forEach(c),B.forEach(c),Ce.forEach(c),this.h()},h(){h(o,"class","hospital-logo svelte-1w8mmqf"),h(w,"class","svelte-1w8mmqf"),h(_,"class","subtitle svelte-1w8mmqf"),h(l,"class","print-header svelte-1w8mmqf"),h(R,"class","label svelte-1w8mmqf"),h(z,"class","token-number svelte-1w8mmqf"),h(U,"class","token-number-section svelte-1w8mmqf"),h(H,"class","date svelte-1w8mmqf"),h(L,"class","time svelte-1w8mmqf"),h(V,"class","datetime-section svelte-1w8mmqf"),h(j,"class","print-btn svelte-1w8mmqf"),h(G,"class","home-btn svelte-1w8mmqf"),h(Q,"class","actions svelte-1w8mmqf"),h(Y,"class","footer-main svelte-1w8mmqf"),h(re,"class","token-footer svelte-1w8mmqf"),h(a,"class","token-card svelte-1w8mmqf"),h(r,"class","container svelte-1w8mmqf")},m(m,I){_e(m,i,I),_e(m,r,I),e(r,a),e(a,l),e(l,o),e(l,u),e(l,w),e(w,x),e(l,b),e(l,_),e(_,n),e(a,N),e(a,U),e(U,R),e(R,O),e(U,W),e(U,z),e(z,K),e(a,se),S&&S.m(a,null),e(a,M),e(a,V),e(V,H),e(H,Z),e(V,J),e(V,L),e(L,E),e(a,y),D&&D.m(a,null),e(a,X),e(a,Q),e(Q,j),e(j,$),e(j,ae),e(Q,te),e(Q,G),e(G,ne),e(G,fe),e(a,we),e(a,re),e(re,Y),e(Y,de),e(Y,be),e(Y,ge),e(Y,ke),e(Y,he),xe||(Ae=[Oe(j,"click",s[5]),Oe(G,"click",s[6])],xe=!0)},p(m,[I]){I&17&&t!==(t=m[4]("tokenPage.yourTokenNumber")+" #"+m[0]+" - "+m[4]("hospital.title"))&&(document.title=t),I&16&&C!==(C=m[4]("hospital.title")+"")&&A(x,C),I&16&&T!==(T=m[4]("tokenPage.subtitle")+"")&&A(n,T),I&16&&F!==(F=m[4]("tokenPage.yourTokenNumber")+"")&&A(O,F),I&1&&A(K,m[0]),m[1]?S?S.p(m,I):(S=Me(m),S.c(),S.m(a,M)):S&&(S.d(1),S=null),I&4&&A(Z,m[2]),I&8&&A(E,m[3]),m[1]?D?D.p(m,I):(D=ze(m),D.c(),D.m(a,X)):D&&(D.d(1),D=null),I&16&&ee!==(ee=m[4]("tokenPage.printToken")+"")&&A(ae,ee),I&16&&ie!==(ie=m[4]("tokenPage.backToHome")+"")&&A(fe,ie),I&16&&ue!==(ue=m[4]("tokenPage.thankYouMessage")+"")&&A(de,ue),I&16&&ce!==(ce=m[4]("hospital.title")+"")&&A(he,ce)},i:Be,o:Be,d(m){m&&(c(i),c(r)),S&&S.d(),D&&D.d(),xe=!1,He(Ae)}}}async function et(s){const t="000018f0-0000-1000-8000-00805f9b34fb",i="00002af1-0000-1000-8000-00805f9b34fb";if(!navigator.bluetooth)throw new Error("Web Bluetooth API is not available in this browser.");let r;try{r=await navigator.bluetooth.requestDevice({filters:[{services:[t]}],optionalServices:[t]}),console.log("Connecting to GATT Server...");const a=await r.gatt.connect();console.log("Getting Service...");const l=await a.getPrimaryService(t);console.log("Getting Characteristic...");const o=await l.getCharacteristic(i);console.log("Sending data in chunks...");const p=20;for(let u=0;u<s.length;u+=p){const w=s.slice(u,u+p);await o.writeValueWithoutResponse(w)}console.log("Data sent to printer.")}catch(a){throw a.name==="NotFoundError"?new Error("No Bluetooth device selected or found."):a.name==="NetworkError"?new Error("Bluetooth connection failed. Is the device in range and discoverable?"):a}finally{r&&r.gatt.connected&&(console.log("Disconnecting from Bluetooth device."),r.gatt.disconnect())}}function tt(s,t,i){let r,a,l,o,p,u;Ee(s,Je,n=>i(4,o=n)),Ee(s,Fe,n=>i(8,p=n)),Ee(s,Ye,n=>i(9,u=n));let w="",C="";Le(()=>{x();const n=setInterval(x,1e3);return()=>clearInterval(n)});function x(){const n=new Date;i(2,w=n.toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"})),i(3,C=n.toLocaleTimeString(void 0))}async function b(){if(typeof window>"u")return;const n=new ye;n.initialize(),n.alignCenter(),n.size(17),n.text(o("hospital.title")),n.newline(),n.size(0),n.text(o("tokenPage.subtitle")),n.newline(2),n.text(o("tokenPage.yourTokenNumber")),n.newline(),n.size(34),n.text(r.toString()),n.newline(2),n.size(0),l&&(n.alignLeft(),n.text(`${o("tokenPage.section")}: ${l.name}`),n.newline(),n.text(`${o("tokenPage.type")}: ${l.type==="clinic"?o("tokenPage.clinic"):o("tokenPage.laboratory")}`),n.newline(),n.text(`${o("tokenPage.feePaid")}: ${l.price} ${o("currency")}`),n.newline(2)),n.alignCenter(),n.text(w),n.newline(),n.text(C),n.newline(2),n.printQRCode(r.toString(),6,"M"),n.newline(2),n.text(o("tokenPage.thankYouMessage")),n.newline(),n.text(o("hospital.title")),n.newline(4),n.cut();const N=n.encode();console.log("ESC/POS Data (Uint8Array):",N),console.log("ESC/POS Data (Base64):",Ze(N));try{await et(N),alert("Printing command sent successfully!")}catch(U){console.error("Printing failed:",U),alert("Printing failed: "+U.message+". Make sure your printer is connected and supported.")}}function _(){Ke("/")}const T=n=>n.number===r;return s.$$.update=()=>{s.$$.dirty&512&&i(0,r=parseInt(u.params.number)),s.$$.dirty&512&&i(7,a=parseInt(u.url.searchParams.get("section")||"0")),s.$$.dirty&384&&i(1,l=p.find(n=>n.id===a)),s.$$.dirty&3&&(l==null||l.queue.find(n=>n.number===r))},[r,l,w,C,o,b,_,a,p,u,T]}class ut extends Qe{constructor(t){super(),je(this,t,tt,$e,Re,{})}}export{ut as component,it as universal};
